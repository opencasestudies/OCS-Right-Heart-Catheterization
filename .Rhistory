knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(survival)
library(GGally)
library(survRM2)
library(knitr)
library(randomForestSRC)
library(ggRandomForests)
library(pROC)
library(grpreg)
library(pec)
rhc <- read.csv("http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/rhc.csv")
rhc_DF <- rhc[,-1]
var.vector <- c(
"cat2",
"sadmdte",
"dschdte",
"dthdte",
"lstctdte",
"death",
"surv2md1",
"ptid"
)
rhc <- read.csv("http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/rhc.csv")
rhc <- rhc[,-1]
var.vector <- c(
"cat2",
"sadmdte",
"dschdte",
"dthdte",
"lstctdte",
"death",
"surv2md1",
"ptid"
)
var.which <- NULL
for (i in var.vector) {
var.which[i] <- which(names(rhc) == i)
}
var.which2 <- NULL
for (i in names(rhc)) {
if( sum(is.na(rhc[,i]))/nrow(rhc) > 0.2 ){
var.which2[i] <- which(names(rhc) == i)
}
}
rhc_DF <- rhc[,-c(var.which, var.which2)]
summary(rhc_DF)
str(rhc_DF)
for (i in names(rhc_DF)) {
if(is.numeric(rhc_DF[,i])){
if(mean(rhc_DF[,i], na.rm = T) < 5){
rhc_DF[,i] <- as.factor((rhc_DF[,i]))
}else{
rhc_DF[,i] <- ((rhc_DF[,i]))
}
}
}
rhc_DF$dth30 <- as.numeric(rhc_DF$dth30) - 1
rhc_DF$swang1 <- as.numeric(rhc_DF$swang1) - 1
table(rhc_DF$swang1)
fit1 <- coxph(Surv(t3d30,dth30) ~ . ,data = rhc_DF)
fit2 <- rfsrc(Surv(t3d30,dth30) ~ ., data = rhc_DF, nsplit = 10, importance = TRUE, ntree = 100)
fitpec1 <- pec(list("Cox" = fit1), formula = Surv(t3d30,dth30) ~ 1, data = dat.rhc, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
fitpec1 <- pec(list("Cox" = fit1), formula = Surv(t3d30,dth30) ~ 1, data = rhc_DF, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
fitpec1 <- pec(list("Cox" = fit2), formula = Surv(t3d30,dth30) ~ 1, data = rhc_DF, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
Surv(t3d30,dth30) ~ 1
full <- Surv(t3d30,dth30) ~ 1
full <- Surv(t3d30,dth30) ~ .
fitpec1 <- pec(list("Cox" = fit2), formula =full, data = rhc_DF, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
full <- Surv(t3d30,dth30) ~ .
fitpec1 <- pec(list("Cox" = fit2), formula =full, data = rhc_DF, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
full <- Surv(t3d30,dth30) ~ .
full
fitpec1 <- pec(list("Cox" = fit2), formula =full, data = rhc_DF, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
full <- Surv(t3d30,dth30) ~ 1
fitpec1 <- pec(list("Cox" = fit2), formula =full, data = rhc_DF, cens.model = 'cox', splitMethod = "cv3", keep.index = TRUE, keep.matrix = TRUE)
